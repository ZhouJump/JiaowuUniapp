import{g as t,m as e,j as s,a4 as a,N as o,x as n,c as i,w as l,i as c,o as d,a as m,f as u,t as r,z as g,b as h,r as f,F as _,n as p,d as b,ab as x,u as C,a7 as y}from"./index-HXBhxmPW.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const v=t.importObject("community",{customUI:!0}),w=t.importObject("goods",{customUI:!0});const I=k({data:()=>({note:{},bottom_hide:!0,formats:{},content:"",comments:[],goods:{},studentid:e("userid")}),onLoad(t){this.getNote(t.id)},methods:{gotoGoods(){s({url:"/pages/apps/ershou/xiangqin?id="+this.goods._id})},async getgoods(){let t=await w.getGoods(this.note.goods);this.goods=t[0]},async sent(){""!==this.content&&(await v.addComment({content:this.content,studentid:this.studentid},this.note._id),this.content="",this.editorCtx.clear(),this.bottom_hide=!0,this.getNote(this.note._id))},async getComment(){if(0!=this.note.comment.length){let t=await v.getComment(this.note.comment);this.comments=t.data}},goto(t){s({url:t})},getName(t,e){let s=["双层","奶油","麻辣","酱香","吮指","美味"],a=["奥利奥","趣多多","脆脆鲨","奇趣蛋","原味鸡","麦满分","酱香饼","鸡蛋仔","铜锣烧","冰激凌","脆升升","星球杯","冰美式"],o=(e-0)*t.slice(-1).charCodeAt()*t.slice(-2).charCodeAt();return s[o%s.length]+a[o%a.length]},getDate(t){let e=new Date(t);return e.getDate()+"/"+e.getMonth()+"/"+e.getFullYear()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},getEditorContent(t){this.content=t.detail.html},format(t){let{name:e,value:s}=t.target.dataset;e&&this.editorCtx.format(e,s)},onEditorReady(){a().select("#editor").context((t=>{this.editorCtx=t.context})).exec()},onStatusChange(t){const e=t.detail;this.formats=e},insertImage(){o({count:1,success:async e=>{n({title:"图片上传中",duration:2e3});let s=Date.now()+".jpg";await t.uploadFile({cloudPath:s,filePath:e.tempFilePaths[0],success:async t=>{n({title:"图片上传完成",duration:2e3}),this.editorCtx.insertImage({src:t.fileID,alt:"图像",width:"100%"})}})}})},async getNote(t){let e=await v.getNote(t);this.note=e.data[0],this.getComment(),this.note.goods&&this.getgoods()}}},[["render",function(t,e,s,a,o,n){const k=c,v=x,w=C,I=y;return d(),i(k,{class:"out-box"},{default:l((()=>[m(k,{class:"head"},{default:l((()=>[u(r(o.note.title?o.note.title:"评论详情"),1)])),_:1}),m(k,{class:"outter"},{default:l((()=>[m(k,{class:"cont ql-container"},{default:l((()=>[m(v,{class:"editor ql-editor",nodes:o.note.content},null,8,["nodes"]),o.note.goods?(d(),i(k,{key:0,onClick:e[0]||(e[0]=t=>n.gotoGoods()),class:"goods"},{default:l((()=>[m(w,{mode:"aspectFill",class:"cover",src:o.goods.imgUrl},null,8,["src"]),m(k,{class:"text"},{default:l((()=>[m(k,{class:"name"},{default:l((()=>[u(r(o.goods.title),1)])),_:1}),m(k,{class:"price"},{default:l((()=>[u("￥"+r(o.goods.price),1)])),_:1})])),_:1}),m(k,{class:"buy"},{default:l((()=>[u(" 立即购买 ")])),_:1})])),_:1})):g("",!0)])),_:1}),m(k,{style:{"margin-left":"20px","margin-top":"10px","margin-bottom":"0"},class:"nick-name"},{default:l((()=>[m(k,{class:"avatar"},{default:l((()=>[u(r(n.getName(o.note._id,o.note.studentid).slice(-1)),1)])),_:1}),m(k,{class:"name"},{default:l((()=>[u(r(n.getName(o.note._id,o.note.studentid)),1)])),_:1})])),_:1}),m(k,{class:"comment-title"},{default:l((()=>[u(" 评论("+r(o.note.comment.length)+") ",1)])),_:1}),m(k,{class:"comment-list"},{default:l((()=>[0===o.note.comment.length?(d(),i(k,{key:0,onClick:e[1]||(e[1]=t=>o.bottom_hide=!1),class:"no-comment comment-item"},{default:l((()=>[u(" 暂无评论，快来抢沙发把 ")])),_:1})):g("",!0),(d(!0),h(_,null,f(o.comments,(t=>(d(),i(k,{class:"comment-item",onClick:e=>n.goto("/pages/apps/shequ/detail?id="+t._id)},{default:l((()=>[m(k,{class:"nick-name"},{default:l((()=>[m(k,{class:"avatar"},{default:l((()=>[u(r(n.getName(o.note._id,t.studentid).slice(-1)),1)])),_:2},1024),m(k,{class:"name"},{default:l((()=>[u(r(n.getName(o.note._id,t.studentid)),1)])),_:2},1024)])),_:2},1024),m(v,{onItemclick:e=>n.goto("/pages/apps/shequ/detail?id="+t._id),nodes:t.content},null,8,["onItemclick","nodes"]),m(k,{class:"date"},{default:l((()=>[u(r(n.getDate(t.date)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),256))])),_:1})])),_:1}),m(k,{class:"bottom",style:p({height:o.bottom_hide?"80px":"240px"})},{default:l((()=>[m(I,{id:"editor",style:p({height:o.bottom_hide?"60px":"180px"}),class:"ql-comment ql-container",placeholder:"输入评论","show-img-size":"","show-img-toolbar":"",onInput:n.getEditorContent,onStatuschange:n.onStatusChange,onFocus:e[2]||(e[2]=t=>o.bottom_hide=!1),onReady:n.onEditorReady},null,8,["style","onInput","onStatuschange","onReady"]),m(k,{style:p({marginTop:o.bottom_hide?"30px":"10px"}),class:"tool-box"},{default:l((()=>[m(k,{onClick:n.format,class:"button-list"},{default:l((()=>[m(k,{class:b(["bi","bi-type-italic",o.formats.italic?"active":""]),"data-name":"italic"},null,8,["class"]),m(k,{class:b(["bi","bi-type-bold",o.formats.bold?"active":""]),"data-name":"bold"},null,8,["class"]),m(k,{class:b(["bi","bi-fonts","24px"===o.formats.fontSize?"active":""]),"data-name":"fontSize","data-value":"24px"},null,8,["class"]),m(k,{class:b(["bi","bi-text-center","center"===o.formats.align?"active":""]),"data-name":"align","data-value":"center"},null,8,["class"]),m(k,{onClick:n.insertImage,style:{"font-size":"14px"},class:"bi bi-image"},null,8,["onClick"])])),_:1},8,["onClick"]),m(k,{onClick:n.sent,class:"sent button"},{default:l((()=>[u(" 发布 ")])),_:1},8,["onClick"]),m(k,{onClick:e[3]||(e[3]=t=>o.bottom_hide=!0),class:"bi bi-chevron-down button icon"})])),_:1},8,["style"])])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-85aa08cc"]]);export{I as default};
