import{g as e,m as t,x as s,M as a,U as l,j as i,D as o,c as n,w as c,i as d,o as u,a as h,f,t as g,b as _,r,F as p,e as m,n as w,A as y,z as b,u as k}from"./index-HXBhxmPW.js";import{_ as C}from"./uni-pay.BARgGD5-.js";import{r as W}from"./uni-app.es.CpUiba3j.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./js_sdk.Dqq72uFy.js";const x=e.importObject("community",{customUI:!0});const j=N({data:()=>({studentid:t("userid"),userinfo:{notes:"加载中",comments:"加载中",view:"加载中"},notes:[],weightNote:{},weightPop:!1,needWeight:0}),onLoad(){this.getUserInfo(),this.getNotes()},methods:{paySuccess(){console.log("pay success"),this.getNotes(),this.weightPop=!1,this.needWeight=0},payCancel(){s({title:"支付取消",icon:"none"})},payfail(){s({title:"支付失败",icon:"none"})},addweight(){this.needWeight+=4},subweight(){this.needWeight>3&&(this.needWeight-=4)},toBuyWeight(e){this.weightPop=!0,this.weightNote=e},buyWeight(){this.needWeight>0&&(this.order_no="test"+Date.now(),this.$refs.pay.open({total_fee:Math.round(100*(.25*this.needWeight-0)),order_no:this.order_no,out_trade_no:this.order_no,description:"为"+this.weightNote.title+"购买"+4*this.needWeight+"点权重",type:"weight",custom:{_id:this.weightNote._id,weight:this.needWeight}}))},async deleteNote(e){let t=this;a({title:"确认删除",content:"确实要删除“"+e.title+"”吗",success:async()=>{await x.delNote(e._id),t.getNotes()}})},getDate(e){let t=new Date(e);return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()},async getNotes(){let e=await x.getNoteByUserId(this.studentid);this.notes=e.data,console.log(e)},async getUserInfo(){let e=await x.getUserData(this.studentid);this.userinfo=e},gotoHome(){l({url:"/pages/apps/shequ/home"})},goto(e){i({url:e})},goToNew(){i({url:"/pages/apps/shequ/new",success:e=>{},fail:()=>{},complete:()=>{}})}}},[["render",function(e,t,s,a,l,i){const N=d,x=k,j=y,D=W(o("uni-pay"),C);return u(),n(N,{class:"out-box"},{default:c((()=>[h(N,{class:"head"},{default:c((()=>[f(" 我的 ")])),_:1}),h(N,{class:"outter"},{default:c((()=>[h(N,{class:"cont"},{default:c((()=>[h(N,{class:"info-box"},{default:c((()=>[h(N,{class:"info-item"},{default:c((()=>[h(N,{class:"name"},{default:c((()=>[f("浏览量")])),_:1}),h(N,{class:"data"},{default:c((()=>[f(g(l.userinfo.view),1)])),_:1})])),_:1}),h(N,{class:"info-item"},{default:c((()=>[h(N,{class:"name"},{default:c((()=>[f("评论量")])),_:1}),h(N,{class:"data"},{default:c((()=>[f(g(l.userinfo.comments),1)])),_:1})])),_:1}),h(N,{class:"info-item"},{default:c((()=>[h(N,{class:"name"},{default:c((()=>[f("帖子数")])),_:1}),h(N,{class:"data"},{default:c((()=>[f(g(l.userinfo.notes),1)])),_:1})])),_:1})])),_:1}),(u(!0),_(p,null,r(l.notes,(e=>(u(),n(N,{class:"note-item"},{default:c((()=>[h(N,{class:"info"},{default:c((()=>[h(x,{class:"cover",mode:"aspectFill",src:e.cover},null,8,["src"]),h(N,{class:"text"},{default:c((()=>[h(N,{class:"name"},{default:c((()=>[f(g(e.title),1)])),_:2},1024),h(N,{style:w({color:0!=e.like?"#ec7152":""}),class:"note-data weight"},{default:c((()=>[h(j,{class:"bi bi-fire"}),f(g((e.sortWeight-4*e.like).toFixed(2))+" ",1),0!=e.like?(u(),n(j,{key:0,class:"payed-weight"},{default:c((()=>[f(" + "+g(4*e.like)+" = "+g(e.sortWeight.toFixed(2)),1)])),_:2},1024)):b("",!0)])),_:2},1032,["style"]),h(N,{class:"note-data"},{default:c((()=>[h(j,{class:"bi bi-eye"}),f(g(e.view),1)])),_:2},1024),h(N,{class:"note-data"},{default:c((()=>[h(j,{class:"bi bi-chat-left-text"}),f(g(e.comment.length),1)])),_:2},1024),h(N,{class:"note-data"},{default:c((()=>[h(j,{class:"bi bi-calendar"}),f(g(i.getDate(e.date)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),h(N,{class:"handel"},{default:c((()=>[h(N,{onClick:t=>i.goto("/pages/apps/shequ/detail?id="+e._id),class:"button"},{default:c((()=>[f("查看帖子")])),_:2},1032,["onClick"]),h(N,{onClick:t=>i.toBuyWeight(e),class:"button"},{default:c((()=>[f("购买权重")])),_:2},1032,["onClick"]),h(N,{onClick:t=>i.deleteNote(e),class:"button"},{default:c((()=>[f("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1}),h(N,{class:"bottom"},{default:c((()=>[h(N,{onClick:i.gotoHome,class:"item"},{default:c((()=>[f(" 主页 ")])),_:1},8,["onClick"]),h(N,{onClick:i.goToNew,class:"item sent"},{default:c((()=>[m("i",{class:"bi bi-plus-lg"})])),_:1},8,["onClick"]),h(N,{class:"item"},{default:c((()=>[f(" 我的 ")])),_:1})])),_:1}),h(N,{style:w({bottom:l.weightPop?"0px":"-400px"}),class:"buy-weight"},{default:c((()=>[h(N,{class:"weight-title"},{default:c((()=>[f("为"+g(l.weightNote.title)+"购买权重",1)])),_:1}),h(N,{class:"count"},{default:c((()=>[h(j,null,{default:c((()=>[f("购买")])),_:1}),h(N,{class:"counter"},{default:c((()=>[h(N,{onClick:t[0]||(t[0]=e=>i.subweight()),class:"btn"},{default:c((()=>[f("-")])),_:1}),h(N,{class:"num"},{default:c((()=>[f(g(l.needWeight),1)])),_:1}),h(N,{onClick:t[1]||(t[1]=e=>i.addweight()),class:"btn"},{default:c((()=>[f("+")])),_:1})])),_:1}),h(j,null,{default:c((()=>[f("权重")])),_:1})])),_:1}),h(N,{class:"btn-box"},{default:c((()=>[h(N,{onClick:t[2]||(t[2]=e=>l.weightPop=!1),class:"cancel"},{default:c((()=>[f(" 取消 ")])),_:1}),h(N,{onClick:t[3]||(t[3]=e=>i.buyWeight()),class:"buy"},{default:c((()=>[h(j,{class:"bi bi-alipay"}),f("￥"+g(.25*l.needWeight)+"购买 ",1)])),_:1})])),_:1})])),_:1},8,["style"]),h(D,{onCancel:i.payCancel,onFail:i.payfail,onSuccess:i.paySuccess,ref:"pay"},null,8,["onCancel","onFail","onSuccess"])])),_:1})}],["__scopeId","data-v-533a457f"]]);export{j as default};
