import{Y as s,l as e,s as t,c as a,w as i,i as l,o as d,a as c,f as n,t as r,n as o,b as m,r as g,F as u,A as h,B as p,e as x,L as f,O as y,d as _,y as b,Q as k}from"./index-Dkb7w5wx.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";const v=s.importObject("chat"),w=s.importObject("userInfo");const S=O({data:()=>({id:"",myid:e("userid"),name:e("username"),isadding:!1,chattext:"",message:{message:[]},user:{},scrollTop:9999999,timer:""}),methods:{focus(s){this.isadding=!1},scroll(s){this.oldTop=s.detail.scrollTop},async sentmeaasge(){let s={type:"text",text:this.chattext,time:Date.now(),sent:!0,id:this.myid};this.message.message.unshift(s),t("message"+this.id,JSON.stringify(this.message)),this.insertmsg(s),this.chattext="",await v.setmessage({cid:this.user.cid,msg:s})},async getuser(){let s=await w.getuser({id:this.id});this.user=s},insertmsg(s){let a=e("message");a=""==a?{msg:[]}:JSON.parse(a);let i=!1;a.msg.forEach(((e,t)=>{e.id==this.user.username&&(i=!0,a.msg[t].chat=s,a.msg.unshift(a.msg.splice(t,1)[0]))})),0==i&&a.msg.unshift({id:this.user.username,name:this.user.nickname,chat:s}),t("message",JSON.stringify(a))},getmessage(){let s=e("message"+this.id);this.message=""==s?{message:[]}:JSON.parse(s)},start(){this.timer=setInterval((()=>{this.getmessage()}),500)}},mounted(){},onLoad(s){this.id=s.id,this.user.name=s.id,this.getuser(),this.start()},onHide(){clearInterval(this.timer)},onShow(){}},[["render",function(s,e,t,O,v,w){const S=l,j=k,C=f,I=y;return d(),a(S,{style:{height:"calc(100% - 140px)"},class:"page"},{default:i((()=>[c(S,{class:"topbox"},{default:i((()=>[c(S,{class:"title"},{default:i((()=>[n(r(v.user.nickname),1)])),_:1})])),_:1}),c(S,{class:"appbox"},{default:i((()=>[c(C,{"scroll-y":"true","scroll-top":v.scrollTop,onClick:e[0]||(e[0]=s=>v.isadding=!1),style:o([{"transition-duration":"200ms"},{height:v.isadding?"calc(100% - 180px)":"calc(100% - 60px)"}])},{default:i((()=>[c(S,{class:"messagebox"},{default:i((()=>[(d(!0),m(u,null,g(v.message.message,(s=>(d(),a(S,{class:_([[s.sent?"chatmy":"chatother"],"message"])},{default:i((()=>["text"==s.type?(d(),a(S,{key:0},{default:i((()=>[c(S,{style:o({filter:s.sent?"hue-rotate("+v.myid/360+"deg)":"hue-rotate("+v.id/360+"deg)"}),class:"avtar"},{default:i((()=>[n(r(s.sent?v.name.slice(-1):v.user.nickname.slice(-1)),1)])),_:2},1032,["style"]),x("span",{class:"text"},r(s.text),1)])),_:2},1024)):b("",!0),"goods"==s.type?(d(),a(S,{key:1},{default:i((()=>[c(j,{url:"/pages/apps/ershou/mysell"},{default:i((()=>[c(S,{class:"goodstext"},{default:i((()=>[n(r(s.text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):b("",!0)])),_:2},1032,["class"])))),256))])),_:1})])),_:1},8,["scroll-top","style"]),c(S,{style:o({height:v.isadding?"180px":"60px",borderRadius:v.isadding?"32px":""}),class:"chatbox"},{default:i((()=>[c(I,{"cursor-spacing":"-40",style:o({width:""!=v.chattext?"calc(100% - 60px)":""}),modelValue:v.chattext,"onUpdate:modelValue":e[1]||(e[1]=s=>v.chattext=s),class:"input"},null,8,["style","modelValue"]),h(x("i",{onClick:e[2]||(e[2]=s=>v.isadding=!v.isadding),style:o({rotate:v.isadding?"45deg":"0deg"}),class:"bi bi-plus-circle add"},null,4),[[p,""==v.chattext]]),h(c(S,{onClick:w.sentmeaasge,class:"sent"},{default:i((()=>[n("发送")])),_:1},8,["onClick"]),[[p,""!=v.chattext]])])),_:1},8,["style"])])),_:1})])),_:1})}],["__scopeId","data-v-a3815097"]]);export{S as default};
