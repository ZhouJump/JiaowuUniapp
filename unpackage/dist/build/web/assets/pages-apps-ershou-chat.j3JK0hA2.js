import{g as s,m as e,s as t,c as a,w as i,i as l,o as d,a as c,f as n,t as r,n as o,b as m,r as g,F as u,B as h,C as p,e as x,K as f,O as y,d as _,z as b,Q as k}from"./index-HXBhxmPW.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=s.importObject("chat"),v=s.importObject("userInfo");const C=O({data:()=>({id:"",myid:e("userid"),name:e("username"),isadding:!1,chattext:"",message:{message:[]},user:{},scrollTop:9999999,timer:""}),methods:{focus(s){this.isadding=!1},scroll(s){this.oldTop=s.detail.scrollTop},async sentmeaasge(){let s={type:"text",text:this.chattext,time:Date.now(),sent:!0,id:this.myid};this.message.message.unshift(s),t("message"+this.id,JSON.stringify(this.message)),this.insertmsg(s),this.chattext="",await w.setmessage({cid:this.user.cid,msg:s})},async getuser(){let s=await v.getuser({id:this.id});this.user=s},insertmsg(s){let a=e("message");a=""==a?{msg:[]}:JSON.parse(a);let i=!1;a.msg.forEach(((e,t)=>{e.id==this.user.username&&(i=!0,a.msg[t].chat=s,a.msg.unshift(a.msg.splice(t,1)[0]))})),0==i&&a.msg.unshift({id:this.user.username,name:this.user.nickname,chat:s}),t("message",JSON.stringify(a))},getmessage(){let s=e("message"+this.id);this.message=""==s?{message:[]}:JSON.parse(s)},start(){this.timer=setInterval((()=>{this.getmessage()}),500)}},mounted(){},onLoad(s){this.id=s.id,this.user.name=s.id,this.getuser(),this.start()},onHide(){clearInterval(this.timer)},onShow(){}},[["render",function(s,e,t,O,w,v){const C=l,S=k,j=f,I=y;return d(),a(C,{style:{height:"calc(100% - 140px)"},class:"page"},{default:i((()=>[c(C,{class:"topbox"},{default:i((()=>[c(C,{class:"title"},{default:i((()=>[n(r(w.user.nickname),1)])),_:1})])),_:1}),c(C,{class:"appbox"},{default:i((()=>[c(j,{"scroll-y":"true","scroll-top":w.scrollTop,onClick:e[0]||(e[0]=s=>w.isadding=!1),style:o([{"transition-duration":"200ms"},{height:w.isadding?"calc(100% - 180px)":"calc(100% - 60px)"}])},{default:i((()=>[c(C,{class:"messagebox"},{default:i((()=>[(d(!0),m(u,null,g(w.message.message,(s=>(d(),a(C,{class:_([[s.sent?"chatmy":"chatother"],"message"])},{default:i((()=>["text"==s.type?(d(),a(C,{key:0},{default:i((()=>[c(C,{style:o({filter:s.sent?"hue-rotate("+w.myid/360+"deg)":"hue-rotate("+w.id/360+"deg)"}),class:"avtar"},{default:i((()=>[n(r(s.sent?w.name.slice(-1):w.user.nickname.slice(-1)),1)])),_:2},1032,["style"]),x("span",{class:"text"},r(s.text),1)])),_:2},1024)):b("",!0),"goods"==s.type?(d(),a(C,{key:1},{default:i((()=>[c(S,{url:"/pages/apps/ershou/mysell"},{default:i((()=>[c(C,{class:"goodstext"},{default:i((()=>[n(r(s.text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):b("",!0)])),_:2},1032,["class"])))),256))])),_:1})])),_:1},8,["scroll-top","style"]),c(C,{style:o({height:w.isadding?"180px":"60px",borderRadius:w.isadding?"32px":""}),class:"chatbox"},{default:i((()=>[c(I,{"cursor-spacing":"-40",style:o({width:""!=w.chattext?"calc(100% - 60px)":""}),modelValue:w.chattext,"onUpdate:modelValue":e[1]||(e[1]=s=>w.chattext=s),class:"input"},null,8,["style","modelValue"]),h(x("i",{onClick:e[2]||(e[2]=s=>w.isadding=!w.isadding),style:o({rotate:w.isadding?"45deg":"0deg"}),class:"bi bi-plus-circle add"},null,4),[[p,""==w.chattext]]),h(c(C,{onClick:v.sentmeaasge,class:"sent"},{default:i((()=>[n("发送")])),_:1},8,["onClick"]),[[p,""!=w.chattext]])])),_:1},8,["style"])])),_:1})])),_:1})}],["__scopeId","data-v-a3815097"]]);export{C as default};
